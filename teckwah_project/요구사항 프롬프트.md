# 페이지별 요구사항 정의

---

## 1. 대시보드 (Dashboard) 페이지

### 1. 기능 개요
- **역할 및 목적:**  
  - **실시간 배송 주문 관리 및 모니터링:**  
    사용자가 하루 단위로 ETA(도착 예정 시간) 및 배송 주문의 실시간 상태를 확인하고, 주문 생성, 상태 변경, 메모 수정, 배차(담당자 배정) 처리 및 선택된 주문 삭제 등 다양한 기능을 수행할 수 있도록 지원합니다.
- **주요 기능 정의:**  
  - **날짜 선택 조회:**  
    - DatePicker를 통해 선택한 날짜의 ETA 또는 배송 주문 데이터를 조회  
    - 데이터가 없을 경우 ‘데이터 없음’ 메시지를 명확하게 표시  
  - **대시보드 생성:**  
    - 신규 배송 주문 항목을 생성 (POST `/dashboard`)
  - **상세 정보 확인:**  
    - 개별 `dashboard_id`를 기반으로 주문의 상세 정보를 조회
  - **상태 변경:**  
    - 상태 변경 시 조건에 따라 (예: `WAITING → IN_PROGRESS`일 때 `depart_time` 업데이트, `IN_PROGRESS → COMPLETE/ISSUE`일 때 `complete_time` 업데이트, `CANCEL/WAITING` 전환 시 모든 시간 필드를 `NULL` 처리)
  - **메모 수정:**  
    - 해당 주문 항목의 메모 내용을 수정
  - **배차(담당자 배정):**  
    - 선택된 여러 `dashboard_id`를 대상으로 벌크 배차 처리(담당자 배정)
  - **주문 삭제:**  
    - 선택된 주문에 대해 벌크 삭제가 가능하도록 구현  
      (첨부된 내용에 따라 DELETE `/dashboard` API 포함)  
      :contentReference[oaicite:3]{index=3}

### 2. 프론트엔드 동작 전용 로직
- **UI 상호작용 및 이벤트 처리:**  
  - DatePicker 변경 시 자동으로 `GET /dashboard/list` API 호출  
  - 테이블 행 선택 시 상세 정보 모달 표시  
  - “생성”, “배차”, “삭제”, “새로고침” 버튼 클릭에 따른 API 호출 및 결과 반영  
  - 다중 선택(체크박스 사용)을 통한 벌크 작업 처리
- **상태 관리:**  
  - 전역 상태(예: Redux 또는 Context API)와 로컬 상태(`useState`)를 혼합하여 선택된 날짜, 주문 데이터, 사용자 정보, 로딩 및 에러 상태 관리
- **비동기 처리 및 렌더링:**  
  - Axios를 이용한 RESTful API 호출  
  - API 호출 중 로딩 스피너 표시 및 실패 시 antd 메시지 컴포넌트로 에러 알림  
  - 조건부 렌더링(데이터 없음 메시지, 테이블 갱신 등)
- **컴포넌트 간 데이터 전달:**  
  - URL 파라미터, Context API, `props`를 활용하여 상세 정보 페이지로 `dashboard_id` 전달

### 3. API 명세
- **주요 API 엔드포인트:**  
  - `GET /dashboard/list`:  
    - 선택 날짜 기준 배송 주문/ETA 데이터 목록 조회  
    - 데이터가 없으면 ‘데이터 없음’ 반환
  - `POST /dashboard`:  
    - 신규 주문(대시보드) 생성  
    - 주문 생성 시 우편번호 처리 및 관련 정보 자동 업데이트 (트리거 활용)
  - `GET /dashboard/{dashboard_id}`:  
    - 개별 주문의 상세 정보 조회
  - `PATCH /dashboard/{dashboard_id}/status`:  
    - 상태 변경 처리 및 조건에 따른 `depart_time`, `complete_time` 업데이트  
    - 일반 사용자와 관리자 권한에 따라 조건 검증
  - `PATCH /dashboard/{dashboard_id}/remark`:  
    - 메모 수정 처리
  - `POST /dashboard/assign`:  
    - 선택된 `dashboard_id` 리스트 기반 벌크 배차 처리(담당자 배정)
  - `DELETE /dashboard`:  
    - 선택된 `dashboard_id` 리스트를 통한 벌크 삭제  
      :contentReference[oaicite:4]{index=4}

### 4. 백엔드 서비스 로직
- **요청 처리 흐름:**  
  1. 라우터가 API 요청 수신  
  2. 요청 데이터 유효성 검사 및 사용자 권한 확인  
  3. 서비스 레이어(`DashboardService`)에서 비즈니스 로직 처리  
  4. 데이터베이스와 상호작용 후 결과 반환
- **비즈니스 로직:**  
  - 날짜 기반 데이터 필터링 및 ETA 기준 정렬  
  - 상태 변경 시 조건 검증과 자동 시간 필드 업데이트 (KST 기준)  
  - 배차 처리 및 주문 삭제 시 벌크 업데이트와 트랜잭션 관리  
  - 신규 주문 생성 시 우편번호 처리, `postal_code` 테이블과 조인, 트리거를 통한 거리/시간 계산 및 지역 정보 업데이트
- **예외 처리:**  
  - 필수 필드 및 데이터 타입 검증, 비즈니스 규칙 위반 시 적절한 HTTP 오류 코드(`400`, `401`, `403`, `404`, `500`) 반환

### 5. DB 연결 서비스 로직
- **ORM 및 SQL 사용:**  
  - ORM 라이브러리(SQLAlchemy) 또는 최적화된 직접 SQL 활용  
  - 조회, 삽입, 수정, 삭제 작업을 ORM 메서드 또는 최적화된 쿼리로 처리
- **트랜잭션 관리:**  
  - 단일 작업 단위 트랜잭션(`READ COMMITTED`) 적용  
  - 오류 발생 시 전체 롤백 처리
- **비동기 DB 접근:**  
  - 필요 시 async DB 드라이버(예: asyncpg) 사용 검토

### 6. 사용 DB 모델 및 트리거
- **주요 테이블:**  
  - **Dashboard:** 배송 주문 및 ETA 데이터  
  - **PostalCode:** 우편번호, 도시/지역, 거리/시간, 허브 정보  
  - **User:** 사용자 및 담당자 정보 (부서, 권한 등)
- **테이블 관계 및 무결성:**  
  - `Dashboard.postal_code` → `PostalCode` (문자열, FK)  
  - `Dashboard.department` → User 테이블의 부서 정보 (FK)
- **트리거 및 자동 업데이트:**  
  - `trg_dashboard_before_insert_postal`:  
    - 주문 생성 전 우편번호 유효성 검사, 거리/시간 계산, 지역 정보 자동 업데이트  
  - 상태 변경 시 자동으로 `depart_time` 및 `complete_time` 업데이트와 감사 로그 생성  
      :contentReference[oaicite:5]{index=5}

---

## 2. 관리자 페이지 (AdminPage)

### 1. 기능 개요
- **역할 및 목적:**  
  - 관리자 전용 페이지로 전체 배송 주문 데이터를 제약 없이 조회, 수정, 상태 변경, 삭제 등 고급 관리 기능을 제공합니다.
- **주요 기능 정의:**  
  - **날짜 선택 조회:**  
    - DatePicker를 통해 전체 데이터를 조회 (상태 제한 없이)
  - **상세 정보 확인 및 수정:**  
    - 주문 상세 정보를 조회하고 수정 가능
  - **상태 변경:**  
    - 관리자 권한으로 조건 없이 상태 변경 (변경 전 확인 모달 표시)
  - **배차(담당자 배정) 및 주문 생성:**  
    - 대시보드 페이지와 동일한 기능 제공
  - **주문 삭제:**  
    - 선택된 `dashboard_id` 리스트를 통한 벌크 삭제  
      :contentReference[oaicite:6]{index=6}

### 2. 프론트엔드 동작 전용 로직
- **UI 상호작용:**  
  - DatePicker 선택 시 관리자용 전체 데이터 조회  
  - 수정, 삭제, 상태 변경 시 “정말 변경/삭제하시겠습니까?” 확인 모달 표시  
  - 버튼 클릭에 따른 관리자 전용 API 호출 및 결과 반영
- **상태 관리:**  
  - 전역 상태(관리자 권한 정보 및 전체 주문 데이터)와 로컬 상태를 사용하여 작업 진행
- **비동기 처리 및 렌더링:**  
  - 로딩 스피너, 에러 메시지 처리, 데이터 재조회 최적화

### 3. API 명세
- **주요 API 엔드포인트 (대시보드 페이지와 동일):**  
  - `GET /dashboard/list`  
  - `POST /dashboard`  
  - `GET /dashboard/{dashboard_id}`  
  - `PATCH /dashboard/{dashboard_id}/status`  
  - `PATCH /dashboard/{dashboard_id}/remark`  
  - `POST /dashboard/assign`
- **추가 API:**  
  - `DELETE /dashboard`:  
    - 관리자 권한으로 선택된 주문을 벌크 삭제  
      :contentReference[oaicite:7]{index=7}
- **인증 및 권한 관리:**  
  - JWT 기반 인증 및 미들웨어를 통한 `user.role === 'ADMIN'` 검증

### 4. 백엔드 서비스 로직
- **요청 처리 흐름:**  
  - 관리자 전용 라우터 → `AdminDashboardService` → 데이터베이스
- **비즈니스 로직:**  
  - 전체 주문 데이터 조회 및 프론트엔드에서 처리하는 페이지네이션  
  - 관리자 권한에 따른 조건 없는 상태 변경 및 삭제 처리  
  - 벌크 삭제 시 트랜잭션 및 롤백 처리 강화
- **예외 처리:**  
  - 관리자 작업 시 입력 데이터 검증 및 오류 발생 시 적절한 HTTP 오류 코드 반환

### 5. DB 연결 서비스 로직
- **ORM 및 SQL 사용:**  
  - 대시보드와 동일한 DB 모델 사용  
  - 관리자 작업에 따른 추가 로깅 및 트랜잭션 처리
- **트랜잭션 관리:**  
  - 단일 작업 단위 트랜잭션 적용, 오류 발생 시 전체 롤백

### 6. 사용 DB 모델 및 트리거
- **주요 테이블:**  
  - `Dashboard`, `PostalCode`, `User/RefreshToken` (대시보드와 공유)
- **트리거:**  
  - 삭제, 상태 변경 등 관리자 작업 시 감사 로그 자동 생성 및 변경 이력 추적  
      :contentReference[oaicite:8]{index=8}

---

## 3. 시각화 (Visualization) 페이지

### 1. 기능 개요
- **역할 및 목적:**  
  배송 현황 및 주문 데이터를 심플하고 직관적인 그래프로 시각적으로 분석하여 인사이트를 제공하며, 부서별, 상태별, 시간대별 데이터 통계를 통한 의사결정 지원
- **데이터 분석 기준:**  
  - 사용자로부터 입력된 날짜 범위는 DB의 `dashboard` 테이블의 `create_time` 컬럼에 적용되어 해당 범위 내의 데이터만 분석 대상으로 사용  
  - 날짜 기간 선택 시, 선택 가능한 날짜는 현재 `create_time`의 최소/최대 값으로 자동 설정되어 사용자에게 제공

### 2. 프론트엔드 동작 전용 로직
- **UI 상호작용 및 이벤트 처리:**  
  - RangePicker 선택 시 `GET /visualization/delivery_status` 및 `GET /visualization/hourly_orders` API 호출  
  - 선택 가능한 날짜는 `GET /visualization/date_range` API를 통해 `create_time`의 최소/최대 값을 반영하여 표시  
  - 차트 유형 토글 버튼 클릭 시 동적 데이터 업데이트 및 심플한 그래프 스타일 적용
- **상태 관리:**  
  - 로컬 상태(`useState`)와 상위 컴포넌트를 통해 날짜 범위, 차트 유형, 로딩 및 에러 상태 관리  
  - 데이터 캐싱 및 재요청 최적화

### 3. 차트 구성 및 UI/UX 개선
- **배송 현황 카드 및 차트:**
  - **배송 현황 카드:**  
    - 전체배송건수, 대기중, 진행중, 완료, 이슈, 취소 등 각 상태별 건수를 카드 형태로 표시  
    - 각 카드에는 파스텔톤 색상으로 상태별 구분이 명확하게 제공됨
  - **배송 현황 차트 (원형 차트):**  
    - 입력된 `create_time` 범위 내 데이터에서 배송 현황을 집계하여, 심플한 원형(파이) 차트로 각 배송 상태의 비율을 표시  
    - 차트 하단에 각 색상에대응하는 배송 상태에 대한 범례(설명) 제공
    - 배송 현황 카드에 사용된 상태별 색상과 동일한 색상으로 비율 그래프 색상 유지

- **시간대별 부서별 데이터 분포 차트:**
  - **데이터 처리:**  
    선택된 날짜 범위 내 `create_time` 데이터를 기준으로, 각 부서별 주문의 시간대별 분포를 분석
  - **차트 구성:**  
    부서별 상태별 데이터(예: 각 부서의 대기중, 진행중, 완료, 이슈, 취소 건수)를 심플한 막대 그래프 혹은 라인 그래프로 시각화  
    - 각 부서에 고유한 파스텔톤 색상 적용하여 전체 디자인의 일관성 유지
  - **UI/UX 개선:**  
    - 간단하고 직관적인 그래프 디자인을 적용하여 데이터 해석을 용이하게 함  
    - 범례를 통해 부서별 색상 및 상태 매핑을 명확하게 제공

### 4. API 명세
- **주요 API 엔드포인트:**  
  - `GET /visualization/delivery_status`:  
    - 시작 날짜와 종료 날짜를 기준으로 `create_time` 범위 내 배송 현황 통계 조회 및 파이 차트 데이터 제공
  - `GET /visualization/hourly_orders`:  
    - 선택한 날짜 범위 내 각 부서별 `create_time` 분포(시간대별 접수 건수) 조회 및 막대 그래프 데이터 제공
  - `GET /visualization/date_range`:  
    - 현재 DB의 `dashboard` 테이블의 `create_time` 컬럼을 기반으로 최소/최대 날짜 제공

----

## 4. 공통 기능 및 레이어 (전체 페이지 적용)

### 1. 기능 개요
- **역할 및 목적:**  
  - 애플리케이션 전반의 사용자 인증/인가, 에러 및 메시지 처리, 로깅, CORS 정책 적용 등 보안과 사용자 경험 개선을 위한 공통 기능 제공
- **주요 기능 정의:**  
  - **사용자 인증 및 권한 관리:**  
    - JWT 기반 로그인 및 토큰 갱신  
    - 사용자 역할(일반 사용자 vs. 관리자)에 따른 접근 제어
  - **에러 인터셉터 및 로그 관리:**  
    - API 에러 인터셉터 및 클라이언트/서버 로그 기록
  - **페이지 라우팅 보호:**  
    - `PrivateRoute`, `AuthProvider`를 통한 인증 상태 및 `returnUrl` 관리  
    - 관리자와 일반 사용자에 따른 라우팅 차별화  
      :contentReference[oaicite:12]{index=12}

### 2. 프론트엔드 동작 전용 로직
- **UI 상호작용 및 이벤트 처리:**  
  - 로그인 페이지에서 사용자 아이디와 비밀번호 입력 및 실시간 유효성 검사  
  - 로그인 버튼 또는 엔터키 입력 시 폼 제출 및 API 호출  
  - 로그인 성공 시 사용자 정보 Context 업데이트와 페이지 리다이렉션  
  - 토큰 만료 또는 갱신 실패 시 로그인 페이지로 강제 리다이렉션
- **상태 관리:**  
  - React `useState`와 Context API를 이용해 인증 상태, 토큰, 사용자 정보를 안전하게 저장 및 전파
- **비동기 처리:**  
  - Axios를 통한 인증 API 호출  
  - 로딩 스피너, 에러 메시지(antd message) 제공  
  - 네트워크 오류, 타임아웃 시 재시도 메커니즘 적용
- **화면 렌더링:**  
  - 조건부 렌더링을 통한 로그인/메인 페이지 분기 처리  
  - 반응형 UI 및 애니메이션 효과 적용  
      :contentReference[oaicite:13]{index=13}

### 3. API 명세
- **인증 관련 API:**  
  - `POST /auth/login`:  
    - 사용자 아이디와 비밀번호를 전송하여 JWT 토큰(액세스, 리프레시) 발급  
    - 요청 데이터:  
      - `user_id` (문자열)  
      - `password` (문자열)
  - (추가적으로 토큰 갱신 및 사용자 정보 조회 API 등 포함)
- **오류 응답 코드:**  
  - `401` (인증 실패), `403` (권한 없음), `500` (서버 에러)  
      :contentReference[oaicite:14]{index=14}

### 4. 백엔드 서비스 로직
- **요청 처리 흐름:**  
  1. 라우터가 로그인 및 인증 관련 엔드포인트 수신  
  2. 입력 데이터 유효성 및 비밀번호 복잡성 검사  
  3. 사용자 정보 저장소 조회 후 비밀번호 해시 비교  
  4. JWT 토큰 생성 및 리프레시 토큰 관리  
  5. 로그인 히스토리 기록 후 응답 반환
- **비즈니스 로직:**  
  - 사용자 존재 여부 확인 및 비밀번호 검증  
  - 토큰 발급, 저장, 만료 시간 관리 (액세스 토큰 60분, 리프레시 토큰 7일)  
  - 권한 레벨에 따른 페이지 리다이렉션 처리 및 CORS 정책 적용
- **예외 처리 및 보안:**  
  - SQL Injection, CSRF, XSS 방지  
  - 반복 로그인 시도 제한 및 보안 이벤트 로깅  
      :contentReference[oaicite:15]{index=15}

### 5. DB 연결 서비스 로직
- **ORM 사용 방식:**  
  - SQLAlchemy를 통한 모델 기반 데이터베이스 상호작용  
  - 사용자 정보, 토큰, 로그인 이력에 대한 최적화된 쿼리 수행
- **데이터 처리 방식:**  
  - 사용자 정보 조회, 토큰 관리, 로그인 이력 기록
- **트랜잭션 관리:**  
  - 세션 기반 트랜잭션 처리, 오류 발생 시 롤백 및 동시성 제어

### 6. 사용 DB 모델 및 트리거
- **주요 테이블:**  
  - **users:** 사용자 기본 정보  
  - **refresh_tokens:** JWT 리프레시 토큰 관리  
  - **login_history:** 로그인 시도 및 성공 이력 기록
- **테이블 관계 및 무결성:**  
  - 외래 키를 통한 사용자-토큰 연결  
  - 데이터 무결성 제약 조건 적용
- **트리거:**  
  - 로그인 시도 기록, 토큰 만료 처리, 보안 이벤트 로깅 자동 실행  
      :contentReference[oaicite:16]{index=16}

---

## 전체 참고
- **날짜 및 시간 처리:**  
  모든 날짜 및 시간 관련 작업(프론트엔드, 백엔드, DB)은 한국 표준시(KST)를 기준으로 처리합니다.
- **코드 및 데이터 형식:**  
  프로젝트 전반에 걸쳐 일관된 코드 구조와 데이터 형식을 유지하며, 변수명, 데이터 스키마, API 요청/응답 형식 등은 통일된 명명 규칙과 설계 원칙을 따릅니다.
- **실행 가능성 및 보안:**  
  모든 서비스는 즉시 실행 가능한 구현을 목표로 하며, JWT 기반 인증, 미들웨어를 통한 권한 관리, SQL Injection, CSRF, XSS 방지 등의 보안 조치를 포함합니다.
- **통합 관리:**  
  인증/인가, 에러 처리, 로그 관리 및 페이지 라우팅 보호는 전반적인 사용자 경험 개선과 보안 강화를 위해 공통 기능으로 구현됩니다.
- **무료 라이브러리 활용:**  
  모든 구현은 무료 라이브러리를 활용하여 진행됩니다.
- **참고:**  
  이 문서는 첨부된 대시보드, 시각화, 인증 관련 내용을 기반으로 작성되었으며, 각 내용의 참조는 다음과 같이 이루어집니다.  
  - 대시보드 및 관리자 페이지 관련: :contentReference[oaicite:17]{index=17}  
  - 시각화 페이지 관련: :contentReference[oaicite:18]{index=18}  
  - 공통 기능 및 인증 관련: :contentReference[oaicite:19]{index=19}
