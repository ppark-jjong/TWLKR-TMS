<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TeckwahTMS - 대시보드</title>
  
  <!-- 파비콘 -->
  <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon">
  
  <!-- Ant Design CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.11.0/dist/reset.css">
  
  <!-- 사용자 정의 CSS -->
  <link rel="stylesheet" href="styles/simple.css">
  
  <!-- 폰트 어썸 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  
  <style>
    /* 대시보드 페이지 추가 스타일 */
    .search-input {
      padding: 8px 12px;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      width: 100%;
      font-size: 0.9rem;
      transition: all 0.3s;
    }
    
    .search-button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      cursor: pointer;
      margin-left: 8px;
    }
    
    .search-container {
      display: flex;
      align-items: center;
    }
    
    .date-filter-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .date-period-container {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .date-range-label {
      margin-right: 10px;
      font-size: 0.9rem;
      color: #666;
      font-weight: 500;
    }
    
    .date-input-group {
      display: flex;
      align-items: center;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      overflow: hidden;
      background-color: white;
    }
    
    .date-input {
      border: none;
      padding: 8px 12px;
      outline: none;
      font-size: 0.9rem;
    }
    
    .date-separator {
      color: #666;
      padding: 0 5px;
    }
    
    .status-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      text-align: center;
      white-space: nowrap;
    }
    
    .bg-yellow { background-color: #fffbe6; color: #ad8b00; }
    .bg-blue { background-color: #e6f7ff; color: #1890ff; }
    .bg-blue-dark { background-color: #096dd9; color: white; }
    .bg-green { background-color: #f6ffed; color: #52c41a; }
    .bg-red { background-color: #fff1f0; color: #f5222d; }
    .bg-gray { background-color: #f5f5f5; color: #595959; }
    
    /* 상세 모달 스타일 */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 100;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      width: 80%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    
    .modal-header {
      padding: 16px 24px;
      border-bottom: 1px solid #f0f0f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-body {
      padding: 24px;
    }
    
    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid #f0f0f0;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      color: #999;
    }
    
    .order-detail-section {
      margin-bottom: 20px;
    }
    
    .section-title {
      font-size: 1.1rem;
      font-weight: 500;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid #f0f0f0;
      color: #333;
    }
    
    .detail-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px 24px;
    }
    
    .detail-item {
      display: flex;
      flex-direction: column;
    }
    
    .detail-label {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 4px;
    }
    
    .detail-value {
      font-size: 0.95rem;
    }
    
    /* 상태 변경 모달 */
    .status-change-modal .modal-content {
      max-width: 400px;
    }
    
    /* 데이터 테이블 행 스타일 */
    .data-table tbody tr {
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .data-table tbody tr:hover {
      background-color: #f5f5f5;
    }
    
    /* 체크박스 셀은 클릭 이벤트 전파 방지 */
    .checkbox-cell {
      cursor: default;
    }
    
    /* 로딩 표시 */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 50;
      font-size: 1.2rem;
      color: #1890ff;
    }
    
    .loading-spinner {
      margin-right: 10px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="app" class="app">
    <!-- 레이아웃 -->
    <div class="main-layout">
      <!-- 사이드바 -->
      <aside id="sidebar" class="sidebar">
        <img class="logo" src="assets/logo.png" alt="로고" style="width: 100%; max-width: 200px; margin: 15px auto; display: block;">
        <div class="logo-container" style="align-content: center;">
          <h1>TWLKR-TMS</h1>
        </div>
        
        <div class="user-info">
          <div class="avatar">
            <i class="fa-solid fa-user"></i>
          </div>
          <div class="user-details">
            <p class="user-name">CSAdmin</p>
            <p class="user-role">CS</p>
          </div>
        </div>
        
        <nav class="menu">
          <ul>
            <li class="menu-item active">
              <a href="dashboard.html">
                <i class="fa-solid fa-chart-line"></i>
                <span>TMS</span>
              </a>
            </li>
            <li class="menu-item">
              <a href="handover.html">
                <i class="fa-solid fa-right-left"></i>
                <span>Work-Notice</span>
              </a>
            </li>
            <li class="menu-item">
              <a href="visualization.html">
                <i class="fa-solid fa-chart-bar"></i>
                <span>Visualization</span>
              </a>
            </li>
          </ul>
        </nav>
        
        <div class="logout-container">
          <button id="logoutBtn" class="logout-btn">
            <i class="fa-solid fa-right-from-bracket"></i>
            <span>로그아웃</span>
          </button>
        </div>
      </aside>
      
      <!-- 메인 컨텐츠 -->
      <main class="main-content">
        <!-- 컨텐츠 영역 -->
        <div id="content-container" class="content-container">
          <!-- 대시보드 페이지 -->
          <div class="page-section" id="dashboardPage">
            <div class="main-card" style="position: relative;">
              <div class="card-header date-filter-header">
                <div class="date-period-container">
                  <h2 style="margin-right: 20px;">배송 관리</h2>
                  <div class="period-select-container" style="display: flex; align-items: center;">
                    <!-- 개선된 날짜 필터 디자인 -->
                    <span class="date-range-label">ETA 기간:</span>
                    <div class="date-input-group">
                      <input type="date" id="quickStartDate" class="date-input">
                      <span class="date-separator">~</span>
                      <input type="date" id="quickEndDate" class="date-input">
                    </div>
                    <button class="btn primary-btn" id="quickDateBtn" style="margin-left: 10px;">
                      <i class="fa-solid fa-search"></i> 조회
                    </button>
                  </div>
                </div>
                
                <div class="search-container" style="max-width: 300px;">
                  <input type="text" id="searchKeyword" class="search-input" placeholder="주문번호">
                  <button class="search-button" id="searchBtn">
                    <i class="fa-solid fa-search"></i>
                  </button>
                </div>
              </div>
              
              <!-- 통합 검색 및 필터 영역 -->
              <div class="control-panel">
                <!-- 필터 영역 -->
                <div class="filter-section">
                  <div class="filter-container">
                    <div class="filter-item">
                      <label for="statusFilter">상태</label>
                      <select id="statusFilter" class="filter-select">
                        <option value="">전체</option>
                        <option value="PENDING">대기</option>
                        <option value="IN_PROGRESS">진행</option>
                        <option value="COMPLETE">완료</option>
                        <option value="ISSUE">이슈</option>
                        <option value="CANCEL">취소</option>
                      </select>
                    </div>
                    
                    <div class="filter-item">
                      <label for="departmentFilter">부서</label>
                      <select id="departmentFilter" class="filter-select">
                        <option value="">전체</option>
                        <option value="CS">CS</option>
                        <option value="HES">HES</option>
                        <option value="LENOVO">LENOVO</option>
                      </select>
                    </div>
                    
                    <div class="filter-item">
                      <label for="warehouseFilter">창고</label>
                      <select id="warehouseFilter" class="filter-select">
                        <option value="">전체</option>
                        <option value="김포">김포</option>
                        <option value="인천">인천</option>
                        <option value="부산">부산</option>
                        <option value="광주">광주</option>
                      </select>
                    </div>
                    
                    <div class="filter-actions">
                      <button class="btn primary-btn" id="applyFilterBtn">
                        <i class="fa-solid fa-filter"></i> 필터 적용
                      </button>
                      <button class="btn secondary-btn" id="resetBtn">
                        <i class="fa-solid fa-rotate-left"></i> 초기화
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- 요약 카드 영역 - 필터링 아래로 이동 -->
              <div class="summary-cards">
                <div class="summary-card">
                  <div class="summary-icon" style="background-color: #f9f0ff; color: var(--type-delivery);">
                    <i class="fa-solid fa-boxes-stacked"></i>
                  </div>
                  <div class="summary-data">
                    <p class="summary-label">배송 건수</p>
                    <h3 class="summary-value" id="totalOrders">0건</h3>
                  </div>
                </div>
                
                <div class="summary-card">
                  <div class="summary-icon" style="background-color: #fff7e6; color: var(--type-pickup);">
                    <i class="fa-solid fa-truck-fast"></i>
                  </div>
                  <div class="summary-data">
                    <p class="summary-label">회수 건수</p>
                    <h3 class="summary-value" id="inProgressOrders">0건</h3>
                  </div>
                </div>
                
                <div class="summary-card">
                  <div class="summary-icon" style="background-color: #fffbe6; color: var(--status-progress);">
                    <i class="fa-solid fa-spinner"></i>
                  </div>
                  <div class="summary-data">
                    <p class="summary-label">진행 (배송+회수)</p>
                    <h3 class="summary-value" id="progressOrders">0건</h3>
                  </div>
                </div>
                
                <div class="summary-card">
                  <div class="summary-icon" style="background-color: #f6ffed; color: var(--status-complete);">
                    <i class="fa-solid fa-check-circle"></i>
                  </div>
                  <div class="summary-data">
                    <p class="summary-label">완료 (배송+회수)</p>
                    <h3 class="summary-value" id="completedOrders">0건</h3>
                  </div>
                </div>
              </div>
              
              <!-- 카드 액션 버튼 - summary-card 아래로 이동 -->
              <div class="card-actions" style="margin: 0 20px 20px; display: flex; justify-content: flex-end;">
                <button class="btn primary-btn" id="refreshBtn">
                  <i class="fa-solid fa-arrows-rotate"></i> 새로고침
                </button>
                <button class="btn primary-btn" id="changeStatusBtn">
                  <i class="fa-solid fa-exchange-alt"></i> 상태 변경
                </button>
                <button class="btn primary-btn" id="assignBtn">
                  <i class="fa-solid fa-truck"></i> 배차 처리
                </button>
                <button class="btn primary-btn" id="newOrderBtn">
                  <i class="fa-solid fa-plus"></i> 신규 등록
                </button>
                <button class="btn danger-btn" id="deleteOrderBtn">
                  <i class="fa-solid fa-trash"></i> 삭제
                </button>
              </div>
              
              <!-- 데이터 테이블 -->
              <div class="table-container">
                <table class="data-table" id="dashboardTable">
                  <thead>
                    <tr>
                      <th class="checkbox-cell">
                        <input type="checkbox" id="selectAll">
                      </th>
                      <th>주문번호</th>
                      <th>고객</th>
                      <th>유형</th>
                      <th>상태</th>
                      <th>부서</th>
                      <th>창고</th>
                      <th>ETA</th>
                      <th>배송기사</th>
                    </tr>
                  </thead>
                  <tbody id="dashboardTableBody">
                    <tr>
                      <td colspan="10" class="empty-table">데이터를 불러오는 중...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <!-- 페이지네이션 -->
              <div class="pagination" id="pagination">
                <button class="page-btn" data-page="prev">
                  <i class="fa-solid fa-chevron-left"></i>
                </button>
                <span class="page-info" id="pageInfo">1 / 1</span>
                <button class="page-btn" data-page="next">
                  <i class="fa-solid fa-chevron-right"></i>
                </button>
                
                <div class="page-size">
                  <span>표시 행 수:</span>
                  <select id="pageSize" class="select-field">
                    <option value="5">5행</option>
                    <option value="10" selected>10행</option>
                    <option value="15">15행</option>
                  </select>
                </div>
              </div>
              
              <!-- 로딩 오버레이 -->
              <div id="loadingOverlay" class="loading-overlay" style="display: none;">
                <i class="fa-solid fa-spinner loading-spinner"></i>
                <span>데이터를 불러오는 중...</span>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
  
  <!-- 모달: 상세 정보 -->
  <div id="orderDetailModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>주문 상세 정보</h3>
        <button class="close-modal" data-modal="orderDetailModal">
          <i class="fa-solid fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <!-- 기본 정보 섹션 -->
        <div class="order-detail-section">
          <div class="section-title">기본 정보</div>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">주문번호</span>
              <span class="detail-value" id="detailOrderId">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">상태</span>
              <span class="detail-value" id="detailStatus">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">고객</span>
              <span class="detail-value" id="detailCustomer">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">유형</span>
              <span class="detail-value" id="detailType">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">부서</span>
              <span class="detail-value" id="detailDepartment">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">창고</span>
              <span class="detail-value" id="detailWarehouse">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">서비스 수준 계약(SLA)</span>
              <span class="detail-value" id="detailSla">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">우편번호</span>
              <span class="detail-value" id="detailPostalCode">-</span>
            </div>
          </div>
        </div>
        
        <!-- 배송 정보 섹션 -->
        <div class="order-detail-section">
          <div class="section-title">배송 정보</div>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">예상 도착 시간 (ETA)</span>
              <span class="detail-value" id="detailEta">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">생성 시간</span>
              <span class="detail-value" id="detailCreateTime">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">출발 시간</span>
              <span class="detail-value" id="detailDepartTime">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">완료 시간</span>
              <span class="detail-value" id="detailCompleteTime">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">배송기사 ID</span>
              <span class="detail-value" id="detailDriver">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">배송기사 연락처</span>
              <span class="detail-value" id="detailDriverContact">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">배송주소</span>
              <span class="detail-value" id="detailAddress">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">연락처</span>
              <span class="detail-value" id="detailContact">-</span>
            </div>
          </div>
        </div>
        
        <!-- 메모 섹션 -->
        <div class="order-detail-section">
          <div class="section-title">메모</div>
          <div class="detail-item">
            <span class="detail-value" id="detailMemo">-</span>
          </div>
        </div>
        
        <!-- 업데이트 정보 섹션 -->
        <div class="order-detail-section">
          <div class="section-title">업데이트 정보</div>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">마지막 업데이트 시간</span>
              <span class="detail-value" id="detailUpdateAt">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">업데이트한 사용자</span>
              <span class="detail-value" id="detailUpdatedBy">-</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn secondary-btn" data-modal="orderDetailModal">닫기</button>
        <button class="btn primary-btn" id="editOrderBtn">
          <i class="fa-solid fa-edit"></i> 수정
        </button>
      </div>
    </div>
  </div>
  
  <!-- 모달: 상태 변경 -->
  <div id="statusChangeModal" class="modal status-change-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>주문 상태 변경</h3>
        <button class="close-modal" data-modal="statusChangeModal">
          <i class="fa-solid fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group" style="margin-bottom: 20px;">
          <label for="newStatus" style="display: block; margin-bottom: 8px;">새 상태</label>
          <select id="newStatus" class="select-field" style="width: 100%;">
            <option value="PENDING">대기</option>
            <option value="IN_PROGRESS">진행</option>
            <option value="COMPLETE">완료</option>
            <option value="ISSUE">이슈</option>
            <option value="CANCEL">취소</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="statusChangeNote" style="display: block; margin-bottom: 8px;">메모</label>
          <textarea id="statusChangeNote" class="textarea-field" style="width: 100%; min-height: 100px; resize: vertical;" placeholder="상태 변경 관련 메모를 입력하세요."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn secondary-btn" data-modal="statusChangeModal">취소</button>
        <button class="btn primary-btn" id="confirmStatusChangeBtn">
          <i class="fa-solid fa-check"></i> 변경 확인
        </button>
      </div>
    </div>
  </div>
  
  <!-- 메시지 팝업 컴포넌트 -->
  <div id="messagePopup" class="message-popup">
    <div class="message-content">
      <i class="fa-solid message-icon"></i>
      <span class="message-text"></span>
    </div>
  </div>
  
  <!-- JavaScript 파일 -->
  <script>
  // 메시지 유틸리티
  const messageUtils = {
    showMessage(message, type = 'info', duration = 3000) {
      const messageEl = document.getElementById('messagePopup');
      if (!messageEl) return;
      
      const messageText = messageEl.querySelector('.message-text');
      const messageIcon = messageEl.querySelector('.message-icon');
      
      // 타입에 따른 아이콘과 클래스 설정
      let iconClass = 'fa-info-circle';
      messageEl.className = 'message-popup';
      
      if (type === 'success') {
        iconClass = 'fa-check-circle';
        messageEl.classList.add('message-success');
      } else if (type === 'error') {
        iconClass = 'fa-times-circle';
        messageEl.classList.add('message-error');
      } else if (type === 'warning') {
        iconClass = 'fa-exclamation-triangle';
        messageEl.classList.add('message-warning');
      } else {
        messageEl.classList.add('message-info');
      }
      
      // 아이콘 및 메시지 설정
      messageIcon.className = `fa-solid ${iconClass} message-icon`;
      messageText.textContent = message;
      
      // 메시지 표시
      messageEl.classList.add('active');
      
      // 타이머 설정
      if (this.messageTimer) {
        clearTimeout(this.messageTimer);
      }
      
      this.messageTimer = setTimeout(() => {
        messageEl.classList.remove('active');
      }, duration);
    },
    
    success(message, duration = 3000) {
      this.showMessage(message, 'success', duration);
    },
    
    error(message, duration = 3000) {
      this.showMessage(message, 'error', duration);
    },
    
    warning(message, duration = 3000) {
      this.showMessage(message, 'warning', duration);
    },
    
    info(message, duration = 3000) {
      this.showMessage(message, 'info', duration);
    }
  };

  // 상태 유틸리티
  const statusUtils = {
    // 상태 텍스트 매핑
    statusText: {
      'PENDING': '대기',
      'IN_PROGRESS': '진행',
      'COMPLETE': '완료',
      'ISSUE': '이슈',
      'CANCEL': '취소'
    },
    
    // 상태 색상 매핑
    statusColors: {
      'PENDING': 'bg-yellow',
      'ASSIGNED': 'bg-blue',
      'IN_PROGRESS': 'bg-blue-dark',
      'COMPLETE': 'bg-green',
      'ISSUE': 'bg-red',
      'CANCEL': 'bg-gray'
    },
    
    /**
     * 상태에 따른 텍스트 반환
     */
    getStatusText(status) {
      return this.statusText[status] || status;
    },
    
    /**
     * 상태에 따른 색상 클래스 반환
     */
    getStatusClass(status) {
      return this.statusColors[status] || 'bg-gray';
    }
  };

  // 모달 제어 유틸
  const modalUtils = {
    /**
     * 모달 열기
     */
    openModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.add('active');
      }
    },
    
    /**
     * 모달 닫기
     */
    closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.remove('active');
      }
    },
    
    /**
     * 모든 모달 닫기
     */
    closeAllModals() {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        modal.classList.remove('active');
      });
    },
    
    /**
     * 모달 초기화 (모든 모달에 닫기 이벤트 추가)
     */
    initModals() {
      // 모달 닫기 버튼에 이벤트 리스너 추가
      const closeButtons = document.querySelectorAll('[data-modal]');
      closeButtons.forEach(button => {
        button.addEventListener('click', () => {
          const modalId = button.getAttribute('data-modal');
          this.closeModal(modalId);
        });
      });
      
      // 모달 바깥 영역 클릭 시 닫기
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.classList.remove('active');
          }
        });
      });
    }
  };

  // 모의 DB
  let DB = {
    orders: [
      { id: 'ORD-001', customer: '삼성전자', type: '배송', status: 'PENDING', department: 'CS', warehouse: '김포', eta: '2025-03-10', createTime: '2025-03-05', driver: '김기사', address: '서울시 강남구 테헤란로 123', recipient: '박수신', contact: '010-1234-5678', memo: '문 앞에 놓아주세요.' },
      { id: 'ORD-002', customer: 'LG전자', type: '배송', status: 'IN_PROGRESS', department: 'HES', warehouse: '인천', eta: '2025-03-11', createTime: '2025-03-06', driver: '이기사', address: '경기도 수원시 영통구 삼성로 456', recipient: '김수신', contact: '010-2345-6789', memo: '경비실에 맡겨주세요.' },
      { id: 'ORD-003', customer: '현대', type: '회수', status: 'COMPLETE', department: 'LENOVO', warehouse: '부산', eta: '2025-03-09', createTime: '2025-03-04', driver: '박기사', address: '부산시 해운대구 마린시티 789', recipient: '최수신', contact: '010-3456-7890', memo: '17시 이후에만 수령 가능합니다.' },
      { id: 'ORD-004', customer: '기아', type: '배송', status: 'ISSUE', department: 'CS', warehouse: '광주', eta: '2025-03-12', createTime: '2025-03-07', driver: '최기사', address: '광주시 서구 상무대로 101', recipient: '정수신', contact: '010-4567-8901', memo: '포장 손상 주의.' },
      { id: 'ORD-005', customer: 'SK하이닉스', type: '회수', status: 'CANCEL', department: 'HES', warehouse: '김포', eta: '2025-03-08', createTime: '2025-03-03', driver: '정기사', address: '경기도 이천시 부발읍 SK로 345', recipient: '이수신', contact: '010-5678-9012', memo: '취소된 주문입니다.' },
      { id: 'ORD-006', customer: '네이버', type: '배송', status: 'PENDING', department: 'CS', warehouse: '김포', eta: '2025-03-13', createTime: '2025-03-08', driver: '강기사', address: '경기도 성남시 분당구 불정로 6', recipient: '한수신', contact: '010-6789-0123', memo: '문앞 배송' },
      { id: 'ORD-007', customer: '카카오', type: '배송', status: 'IN_PROGRESS', department: 'HES', warehouse: '인천', eta: '2025-03-14', createTime: '2025-03-09', driver: '고기사', address: '제주특별자치도 제주시 첨단로 242', recipient: '임수신', contact: '010-7890-1234', memo: '부재시 경비실' },
      { id: 'ORD-008', customer: '쿠팡', type: '회수', status: 'PENDING', department: 'LENOVO', warehouse: '부산', eta: '2025-03-15', createTime: '2025-03-10', driver: '배기사', address: '서울시 송파구 송파대로 570', recipient: '성수신', contact: '010-8901-2345', memo: '재포장 필요' }
    ]
  };

  // 변수 선언
  let filteredOrders = []; // 현재 필터링된 주문 목록
  let currentPage = 1; // 현재 페이지
  let pageSize = 10; // 페이지당 표시 항목 수
  
  // 로딩 표시기 제어
  const loadingUtils = {
    show() {
      document.getElementById('loadingOverlay').style.display = 'flex';
    },
    
    hide() {
      document.getElementById('loadingOverlay').style.display = 'none';
    }
  };
  
  // 날짜 문자열 비교 함수
  function isDateInRange(dateStr, startDateStr, endDateStr) {
    const date = new Date(dateStr);
    const startDate = new Date(startDateStr);
    const endDate = new Date(endDateStr);
    
    // 날짜 범위에 시간을 포함시키기 위해 종료일의 시간을 23:59:59로 설정
    endDate.setHours(23, 59, 59, 999);
    
    return date >= startDate && date <= endDate;
  }
  
  // 주문 데이터 불러오기 (ETA 날짜 기준으로 필터링)
  function loadOrdersByDateRange(startDate, endDate) {
    loadingUtils.show();
    
    // 실제 구현에서는 API 호출이 들어가겠지만, 
    // 여기서는 모의 데이터를 사용해 setTimeout으로 API 호출 지연 시뮬레이션
    setTimeout(() => {
      // ETA를 기준으로 날짜 범위 필터링
      filteredOrders = DB.orders.filter(order => 
        isDateInRange(order.eta, startDate, endDate)
      );
      
      displayOrders(filteredOrders);
      updateSummaryCards(filteredOrders);
      loadingUtils.hide();
      
      messageUtils.success(`ETA 기간 (${startDate} ~ ${endDate})으로 ${filteredOrders.length}건의 데이터를 조회했습니다.`);
    }, 500); // 0.5초 지연
  }
  
  // 주문번호로 검색
  function searchByOrderId(keyword) {
    if (!keyword.trim()) {
      messageUtils.warning('검색어를 입력해주세요.');
      return;
    }
    
    loadingUtils.show();
    
    // 주문번호에 대한 전체 DB 검색 (대소문자 무시)
    setTimeout(() => {
      const results = DB.orders.filter(order => 
        order.id.toLowerCase().includes(keyword.toLowerCase())
      );
      
      filteredOrders = results;
      displayOrders(results);
      updateSummaryCards(results);
      loadingUtils.hide();
      
      if (results.length > 0) {
        messageUtils.success(`'${keyword}' 검색 결과: ${results.length}건의 주문을 찾았습니다.`);
      } else {
        messageUtils.info(`'${keyword}'에 대한 검색 결과가 없습니다.`);
      }
    }, 500);
  }
  
  // 필터 적용
  function applyFilters() {
    const status = document.getElementById('statusFilter').value;
    const department = document.getElementById('departmentFilter').value;
    const warehouse = document.getElementById('warehouseFilter').value;
    
    // 이미 날짜로 필터링된 결과에서 추가 필터 적용
    let results = [...filteredOrders];
    
    if (status) {
      results = results.filter(order => order.status === status);
    }
    
    if (department) {
      results = results.filter(order => order.department === department);
    }
    
    if (warehouse) {
      results = results.filter(order => order.warehouse === warehouse);
    }
    
    displayOrders(results);
    updateSummaryCards(results);
    
    // 적용된 필터 개수 계산
    const filterCount = [status, department, warehouse].filter(Boolean).length;
    messageUtils.success(`${filterCount}개의 필터가 적용되었습니다. (${results.length}건 표시)`);
  }
  
  // 필터 초기화
  function resetFilters() {
    document.getElementById('statusFilter').value = '';
    document.getElementById('departmentFilter').value = '';
    document.getElementById('warehouseFilter').value = '';
    
    // 날짜 범위는 유지하면서 전체 데이터 다시 표시
    displayOrders(filteredOrders);
    updateSummaryCards(filteredOrders);
    
    messageUtils.info('필터가 초기화되었습니다.');
  }
  
  // 주문 테이블 표시
  function displayOrders(orders) {
    const tableBody = document.getElementById('dashboardTableBody');
    if (!tableBody) return;
    
    // 페이지네이션 계산
    const totalPages = Math.ceil(orders.length / pageSize);
    currentPage = Math.min(currentPage, totalPages || 1);
    
    const startIndex = (currentPage - 1) * pageSize;
    const endIndex = Math.min(startIndex + pageSize, orders.length);
    const pageOrders = orders.slice(startIndex, endIndex);
    
    // 테이블 비우기
    tableBody.innerHTML = '';
    
    // 데이터가 없는 경우
    if (pageOrders.length === 0) {
      const emptyRow = document.createElement('tr');
      const emptyCell = document.createElement('td');
      emptyCell.colSpan = 10;
      emptyCell.className = 'empty-table';
      emptyCell.textContent = '조회된 데이터가 없습니다.';
      emptyRow.appendChild(emptyCell);
      tableBody.appendChild(emptyRow);
      
      // 페이지네이션 업데이트
      document.getElementById('pageInfo').textContent = '0 / 0';
      return;
    }
    
    // 데이터 추가
    pageOrders.forEach(order => {
      const row = document.createElement('tr');
      row.setAttribute('data-id', order.id);
      
      // 체크박스
      const checkCell = document.createElement('td');
      checkCell.className = 'checkbox-cell';
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.value = order.id;
      checkbox.className = 'row-checkbox';
      
      // 체크박스 클릭 시 행 선택 전파 방지
      checkbox.addEventListener('click', (e) => {
        e.stopPropagation();
      });
      
      checkCell.appendChild(checkbox);
      row.appendChild(checkCell);
      
      // 주문번호
      const idCell = document.createElement('td');
      idCell.textContent = order.id;
      row.appendChild(idCell);
      
      // 고객
      const customerCell = document.createElement('td');
      customerCell.textContent = order.customer;
      row.appendChild(customerCell);
      
      // 유형
      const typeCell = document.createElement('td');
      typeCell.textContent = order.type;
      row.appendChild(typeCell);
      
      // 상태
      const statusCell = document.createElement('td');
      const statusBadge = document.createElement('span');
      statusBadge.className = 'status-badge ' + statusUtils.getStatusClass(order.status);
      statusBadge.textContent = statusUtils.getStatusText(order.status);
      statusCell.appendChild(statusBadge);
      row.appendChild(statusCell);
      
      // 부서
      const deptCell = document.createElement('td');
      deptCell.textContent = order.department;
      row.appendChild(deptCell);
      
      // 창고
      const warehouseCell = document.createElement('td');
      warehouseCell.textContent = order.warehouse;
      row.appendChild(warehouseCell);
      
      // ETA
      const etaCell = document.createElement('td');
      etaCell.textContent = order.eta;
      row.appendChild(etaCell);
      
      // 배송기사
      const driverCell = document.createElement('td');
      driverCell.textContent = order.driver;
      row.appendChild(driverCell);
      
      // 행 클릭 이벤트 (상세 정보 모달 표시)
      row.addEventListener('click', () => {
        showOrderDetail(order);
      });
      
      tableBody.appendChild(row);
    });
    
    // 페이지네이션 업데이트
    document.getElementById('pageInfo').textContent = `${currentPage} / ${totalPages}`;
    
    // 페이지네이션 버튼 상태 업데이트
    const prevBtn = document.querySelector('.page-btn[data-page="prev"]');
    const nextBtn = document.querySelector('.page-btn[data-page="next"]');
    
    prevBtn.disabled = currentPage <= 1;
    prevBtn.style.opacity = currentPage <= 1 ? 0.5 : 1;
    
    nextBtn.disabled = currentPage >= totalPages;
    nextBtn.style.opacity = currentPage >= totalPages ? 0.5 : 1;
  }
  
  // 요약 카드 업데이트
  function updateSummaryCards(orders) {
    // 배송 건수 (유형이 '배송'인 주문 수)
    const deliveryCount = orders.filter(order => order.type === '배송').length;
    document.getElementById('totalOrders').textContent = `${deliveryCount}건`;
    
    // 회수 건수 (유형이 '회수'인 주문 수)
    const pickupCount = orders.filter(order => order.type === '회수').length;
    document.getElementById('inProgressOrders').textContent = `${pickupCount}건`;
    
    // 진행 건수 (상태가 'IN_PROGRESS'인 주문 수)
    const progressCount = orders.filter(order => order.status === 'IN_PROGRESS').length;
    document.getElementById('progressOrders').textContent = `${progressCount}건`;
    
    // 완료 건수 (상태가 'COMPLETE'인 주문 수)
    const completeCount = orders.filter(order => order.status === 'COMPLETE').length;
    document.getElementById('completedOrders').textContent = `${completeCount}건`;
  }
  
  // 주문 상세 정보 표시
  function showOrderDetail(order) {
    // 모달에 데이터 채우기
    document.getElementById('detailOrderId').textContent = order.id;
    
    const statusEl = document.getElementById('detailStatus');
    statusEl.textContent = statusUtils.getStatusText(order.status);
    statusEl.className = 'detail-value status-badge ' + statusUtils.getStatusClass(order.status);
    
    document.getElementById('detailCustomer').textContent = order.customer;
    document.getElementById('detailType').textContent = order.type;
    document.getElementById('detailDepartment').textContent = order.department;
    document.getElementById('detailWarehouse').textContent = order.warehouse;
    document.getElementById('detailEta').textContent = order.eta;
    document.getElementById('detailDriver').textContent = order.driver;
    document.getElementById('detailAddress').textContent = order.address;
    document.getElementById('detailRecipient').textContent = order.recipient;
    document.getElementById('detailContact').textContent = order.contact;
    document.getElementById('detailMemo').textContent = order.memo;
    
    // 모달 열기
    modalUtils.openModal('orderDetailModal');
  }
  
  // 주문 상태 변경 처리
  function changeOrderStatus() {
    // 선택된 행 확인
    const checkedRows = document.querySelectorAll('.row-checkbox:checked');
    if (checkedRows.length === 0) {
      messageUtils.warning('변경할 주문을 선택해주세요.');
      return;
    }
    
    // 상태 변경 모달 열기
    modalUtils.openModal('statusChangeModal');
  }
  
  // 컨펌 상태 변경 처리
  function confirmStatusChange() {
    const newStatus = document.getElementById('newStatus').value;
    const note = document.getElementById('statusChangeNote').value;
    
    // 선택된 행 확인
    const checkedRows = document.querySelectorAll('.row-checkbox:checked');
    const selectedIds = Array.from(checkedRows).map(checkbox => checkbox.value);
    
    // 실제 상태 변경 (모의 DB 업데이트)
    selectedIds.forEach(id => {
      const order = DB.orders.find(order => order.id === id);
      if (order) {
        order.status = newStatus;
        if (note) {
          order.memo = note + '\n\n' + (order.memo || '');
        }
      }
    });
    
    // 모달 닫기
    modalUtils.closeModal('statusChangeModal');
    
    // 현재 필터로 데이터 다시 로드
    applyFilters();
    
    // 성공 메시지
    messageUtils.success(`${selectedIds.length}건의 주문 상태가 '${statusUtils.getStatusText(newStatus)}'(으)로 변경되었습니다.`);
    
    // 선택 항목 초기화
    document.querySelectorAll('.row-checkbox:checked').forEach(checkbox => {
      checkbox.checked = false;
    });
    
    document.getElementById('selectAll').checked = false;
  }
  
  // 날짜 기본값 설정
  function setDefaultDates() {
    const today = new Date();
    const endDate = today.toISOString().split('T')[0];
    
    const startDate = new Date();
    startDate.setDate(today.getDate() - 7);
    const startDateStr = startDate.toISOString().split('T')[0];
    
    document.getElementById('quickStartDate').value = startDateStr;
    document.getElementById('quickEndDate').value = endDate;
    
    return { startDate: startDateStr, endDate };
  }
  
  // 페이지 초기화
  document.addEventListener('DOMContentLoaded', function() {
    // 모달 초기화
    modalUtils.initModals();
    
    // 기본 날짜 설정 및 초기 데이터 로드
    const { startDate, endDate } = setDefaultDates();
    loadOrdersByDateRange(startDate, endDate);
    
    // 페이지 사이즈 변경 이벤트
    const pageSizeSelector = document.getElementById('pageSize');
    if (pageSizeSelector) {
      pageSizeSelector.addEventListener('change', function() {
        pageSize = parseInt(this.value);
        currentPage = 1; // 페이지 크기 변경 시 첫 페이지로 이동
        displayOrders(filteredOrders);
      });
    }
    
    // 페이지 네비게이션 이벤트
    const pageButtons = document.querySelectorAll('.page-btn');
    pageButtons.forEach(button => {
      button.addEventListener('click', function() {
        const direction = this.getAttribute('data-page');
        
        if (direction === 'prev' && currentPage > 1) {
          currentPage--;
        } else if (direction === 'next' && currentPage < Math.ceil(filteredOrders.length / pageSize)) {
          currentPage++;
        }
        
        displayOrders(filteredOrders);
      });
    });
    
    // 전체 선택 체크박스 이벤트
    const selectAllCheckbox = document.getElementById('selectAll');
    if (selectAllCheckbox) {
      selectAllCheckbox.addEventListener('click', function(e) {
        const isChecked = this.checked;
        document.querySelectorAll('.row-checkbox').forEach(checkbox => {
          checkbox.checked = isChecked;
        });
      });
    }
    
    // 로그아웃 버튼 이벤트
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', function() {
        if (confirm('로그아웃 하시겠습니까?')) {
          messageUtils.info('로그아웃되었습니다.');
          setTimeout(() => {
            window.location.reload();
          }, 1500);
        }
      });
    }
    
    // 새로고침 버튼
    const refreshBtn = document.getElementById('refreshBtn');
    if (refreshBtn) {
      refreshBtn.addEventListener('click', function() {
        const startDate = document.getElementById('quickStartDate').value;
        const endDate = document.getElementById('quickEndDate').value;
        
        if (startDate && endDate) {
          loadOrdersByDateRange(startDate, endDate);
        } else {
          messageUtils.warning('시작일과 종료일을 모두 입력해주세요.');
        }
      });
    }
    
    // 필터 적용 버튼
    const applyFilterBtn = document.getElementById('applyFilterBtn');
    if (applyFilterBtn) {
      applyFilterBtn.addEventListener('click', applyFilters);
    }
    
    // 리셋 버튼
    const resetBtn = document.getElementById('resetBtn');
    if (resetBtn) {
      resetBtn.addEventListener('click', resetFilters);
    }
    
    // 상태 변경 버튼
    const changeStatusBtn = document.getElementById('changeStatusBtn');
    if (changeStatusBtn) {
      changeStatusBtn.addEventListener('click', changeOrderStatus);
    }
    
    // 상태 변경 확인 버튼
    const confirmStatusChangeBtn = document.getElementById('confirmStatusChangeBtn');
    if (confirmStatusChangeBtn) {
      confirmStatusChangeBtn.addEventListener('click', confirmStatusChange);
    }
    
    // 배차 처리 버튼
    const assignBtn = document.getElementById('assignBtn');
    if (assignBtn) {
      assignBtn.addEventListener('click', function() {
        const checkedRows = document.querySelectorAll('.row-checkbox:checked');
        if (checkedRows.length === 0) {
          messageUtils.warning('배차 처리할 주문을 선택해주세요.');
          return;
        }
        
        messageUtils.info('배차 처리 기능은 추후 구현 예정입니다.');
      });
    }
    
    // 신규 등록 버튼
    const newOrderBtn = document.getElementById('newOrderBtn');
    if (newOrderBtn) {
      newOrderBtn.addEventListener('click', function() {
        messageUtils.info('신규 등록 기능은 추후 구현 예정입니다.');
      });
    }
    
    // 삭제 버튼
    const deleteOrderBtn = document.getElementById('deleteOrderBtn');
    if (deleteOrderBtn) {
      deleteOrderBtn.addEventListener('click', function() {
        const checkedRows = document.querySelectorAll('.row-checkbox:checked');
        if (checkedRows.length === 0) {
          messageUtils.warning('삭제할 주문을 선택해주세요.');
          return;
        }
        
        if (confirm(`선택한 ${checkedRows.length}건의 주문을 삭제하시겠습니까?`)) {
          const selectedIds = Array.from(checkedRows).map(checkbox => checkbox.value);
          
          // 모의 DB에서 삭제
          selectedIds.forEach(id => {
            const index = DB.orders.findIndex(order => order.id === id);
            if (index !== -1) {
              DB.orders.splice(index, 1);
            }
          });
          
          // 현재 필터링된 목록에서도 삭제
          filteredOrders = filteredOrders.filter(order => !selectedIds.includes(order.id));
          
          // 테이블 업데이트
          displayOrders(filteredOrders);
          updateSummaryCards(filteredOrders);
          
          messageUtils.success(`${selectedIds.length}건의 주문이 삭제되었습니다.`);
        }
      });
    }
    
    // 검색 버튼
    const searchBtn = document.getElementById('searchBtn');
    if (searchBtn) {
      searchBtn.addEventListener('click', function() {
        const keyword = document.getElementById('searchKeyword').value;
        searchByOrderId(keyword);
      });
    }
    
    // 검색창 엔터 키 이벤트
    const searchInput = document.getElementById('searchKeyword');
    if (searchInput) {
      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          searchByOrderId(this.value);
        }
      });
    }
    
    // 날짜 조회 버튼
    const quickDateBtn = document.getElementById('quickDateBtn');
    if (quickDateBtn) {
      quickDateBtn.addEventListener('click', function() {
        const startDate = document.getElementById('quickStartDate').value;
        const endDate = document.getElementById('quickEndDate').value;
        
        if (!startDate || !endDate) {
          messageUtils.warning('시작일과 종료일을 모두 입력해주세요.');
          return;
        }
        
        loadOrdersByDateRange(startDate, endDate);
      });
    }
    
    // 수정 버튼
    const editOrderBtn = document.getElementById('editOrderBtn');
    if (editOrderBtn) {
      editOrderBtn.addEventListener('click', function() {
        const orderId = document.getElementById('detailOrderId').textContent;
        messageUtils.info(`주문 ${orderId}의 수정 기능은 추후 구현 예정입니다.`);
      });
    }
  });
  </script>
</body>
</html>
