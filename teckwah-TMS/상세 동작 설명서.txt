배송 실시간 관제 시스템 상세 동작 명세서 (업데이트)
개요
이 문서는 프로젝트 전반에 대한 기능 명세와 동작 규칙을 통합하여 정리한 문서입니다.
모든 페이지는 행 단위 락(Row-Level Lock), 권한(ADMIN/USER), 상태 변경 규칙 등을 따르며, 초기 로드값(페이지 진입 시 미리 데이터 로드)이 존재합니다.

1. 권한 구조
1.1 관리자 권한 (ADMIN)

접근 가능 페이지: 대시보드, 인수인계, 시각화, 사용자 관리 (즉, 전체 페이지)
데이터 권한

조회/생성/수정/삭제: 모든 항목 제한 없음
상태 변경: 5가지 상태(대기/진행/완료/이슈/취소)를 어느 방향으로든 변경 가능(역행·롤백 포함)


사용자 관리

사용자 생성, 삭제, 권한 변경 가능



1.2 일반 사용자 권한 (USER)

접근 가능 페이지: 대시보드, 인수인계
데이터 권한

조회: 모든 데이터 조회 가능
생성: 새 항목(주문, 인수인계 등) 생성 가능
수정: 행 단위 락 해제 시, 주문·인수인계 등 항목 수정 가능
삭제: 불가능 (개발 요구사항 상 일반 사용자 삭제 제한)


상태 변경 규칙

대기 → 진행
진행 → 완료 / 이슈 / 취소
(역행 불가)



<br />

2. 행 단위 락 (Row-Level Lock)

모든 데이터 변경 작업(수정, 삭제, 상태변경) 전, 해당 레코드(행)에 대한 락이 필요
이미 다른 사용자가 해당 행을 점유(락) 중이면 작업 거부 & "누가 사용 중인지" 알림
락 획득에 성공해야 변경 가능
작업 완료(수정·삭제·상태변경) 후 락 해제

2.1 행 단위 락 구현 방식

별도의 Lock 모델 없이 기존 데이터 모델의 필드를 활용하여 락 상태 관리
updated_by 필드를 사용하여 "누가 현재 락을 소유 중인지" 표시
updated_at 필드를 사용하여 "언제 락을 획득했는지" 표시
락 확인 로직: 다른 사용자가 최근(예: 30분 이내) updated_at 필드를 변경했는지 확인
락 획득: 해당 레코드의 updated_by, updated_at 필드를 현재 사용자와 현재 시간으로 업데이트
락 해제: 작업 완료 후 자동으로 락이 해제됨 (별도 해제 작업 불필요)

2.2 락 알림 처리

다른 사용자가 락을 소유 중일 때 팝업 알림을 통해 사용자에게 알림
알림에는 락 소유 사용자와 락 획득 시간 정보 표시
다중 행 처리 시 락 상태에 따라 처리 가능/불가 항목 구분하여 알림

<br />

3. 인증 및 세션

로그인 필수

인증되지 않은 상태에서 어떤 페이지에 접근하면 로그인 페이지로 자동 이동


로그인 성공 시

세션 쿠키 설정 → 기본 진입 페이지인 대시보드로 이동


세션 만료

특정 시간 초과 시 자동으로 로그인 페이지로 이동


로그아웃

세션 삭제 후 로그인 페이지로 이동



<br />

4. 대시보드 (DashboardPage)
4.1 초기 로드(기본 로드값)

ETA(날짜) 조회 기본값: 오늘

페이지 마운트 시 '오늘 날짜' 기준으로 DB에서 주문(ETA가 오늘인 항목)을 SSR로 불러옴
이후 상태·부서·창고 필터는 클라이언트(CSR) 측에서 필터링



4.2 데이터 조회 및 필터링

서버 조회(SSR)

날짜(ETA) 범위가 서버로 전송되어, 그 기간의 주문만 로드


클라이언트 필터(CSR)

상태, 부서, 창고는 이미 받은 데이터를 브라우저에서 재필터링


검색(order_no)

order_no로 DB에 직접 검색, 즉 CSR 검색이 아닌 api 호출로 백엔드 서버로직 활용



4.3 테이블 및 컬럼

테이블 행 색상:

각 행은 주문 상태에 따라 배경색이 다르게 표시됨:

대기: 연한 노란색 (#fffbe6)
진행: 연한 파란색 (#e6f7ff)
완료: 연한 녹색 (#f6ffed)
이슈: 연한 빨간색 (#fff2f0)
취소: 연한 회색 (#f5f5f5)




기본 컬럼:

(체크박스), 부서, 유형, 창고, 주문번호, ETA, 상태, 도착지, 고객명, 기사명


컬럼 커스터마이징:

테이블 상단 설정 아이콘을 통해 표시할 컬럼을 선택 가능
선택 내용은 localStorage에 저장되어 페이지 새로고침 후에도 유지


페이지네이션:

페이지 크기 선택 가능: 10행, 30행, 50행
서버에서 페이지 단위로 데이터 전송, 클라이언트는 해당 페이지 데이터만 표시



4.4 행 상호작용 및 선택

행 클릭:

행 클릭 시 해당 주문의 상세 정보 모달 표시 (체크박스 영역 제외)


체크박스 선택:

개별 행 체크박스 또는 전체 선택 체크박스를 통해 여러 행 선택 가능
행이 선택되면 테이블 상단에 선택된 행 수와 가능한 액션(상태 변경, 배차 처리, 삭제) 표시



4.5 상세정보 모달

행 클릭 시 모달창 표시
내용: 주문의 모든 필드, 마지막 업데이트 유저, 마지막 업데이트 시각 등
UI/UX: 모달 너비를 최대화해 스크롤 최소화, 하단에 '수정', '닫기' 버튼 고정 표시
락 처리: 다른 사용자가 락을 소유 중일 경우 수정 버튼 비활성화 및 알림 표시

4.6 주문 생성·수정·삭제

생성

필수 입력 필드

order_no, type(드롭다운), department(드롭다운), warehouse(드롭다운), SLA(문자 필드), ETA(날짜/시간), postal_code(5자리), address(텍스트), customer(문자), contact(010-xxxx-xxxx)
postal_code: 4자리만 입력되면 앞에 '0'을 자동 보완(프론트/백엔드 공통)




수정

행 단위 락 확인 후 수정 가능
다른 사용자가 락을 소유 중인 경우 수정 불가 및 알림 표시
마지막 수정자 및 수정 시간은 매번 갱신(updated_at, updated_by 컬럼 사용)


삭제

일괄 삭제 로직 적용(단일 항목 선택도 내부적으로 일괄 삭제와 동일 흐름)
관리자만 가능, 일반 사용자는 불가
선택된 행 중 락 상태에 있는 항목은 처리에서 제외하고 알림 표시



4.7 주문 상태 변경

상태 종류: 대기, 진행, 완료, 이슈, 취소 (총 5가지)
일반 사용자(USER):

대기 → 진행
진행 → 완료 / 이슈 / 취소


관리자(ADMIN):

모든 상태 간 자유 전이 가능(역행·롤백 가능)
롤백 시 알림 처리 필수


자동 시간 기록:

대기 → 진행 시 depart_time 기록
진행 → 완료/이슈/취소 시 complete_time 기록


락 처리:

선택된 행 중 락 상태에 있는 항목은 상태 변경에서 제외
처리 결과(성공/실패/락 상태 제외)는 알림으로 표시



4.8 배차(기사 배정)

다중 행(체크박스로 선택된 주문들)에 대해 driver_name을 일괄 배정 가능
일반 사용자도 가능하나, 락 상태 확인 필요
락이 걸린 항목은 배차 처리에서 제외하고 알림 표시
처리 결과(성공/실패/락 상태 제외)는 알림으로 표시

<br />

5. 인수인계 (HandoverPage)
5.1 초기 로드

페이지 마운트 시, 인수인계/공지사항 데이터를 모두 로드
상단 30%는 공지사항 목록, 하단 70%는 인수인계 목록 (각각 별도 페이지네이션)

5.2 공지사항 vs 인수인계

공지사항 등록

관리자만 체크 가능("공지사항 등록" 체크박스)
공지사항으로 등록되면 상단 리스트에 표시


인수인계

일반 사용자도 생성 가능
본인이 작성한 인수인계만 수정 가능 (행 락 필요)



5.3 생성·수정·삭제

생성

공지사항: 관리자만
인수인계: 일반 사용자 가능


수정

본인이 작성한 인수인계 수정 가능(관리자라면 모든 항목 수정 가능)
락 확인 후 수정 가능, 다른 사용자가 락을 소유 중인 경우 수정 불가 및 알림 표시


삭제

관리자만 가능
일반 사용자는 인수인계·공지사항 모두 삭제 불가


시간 기록

최초 생성 시각: 계속 유지
업데이트 시각: 수정할 때마다 갱신
마지막 업데이트 유저와 시간은 레코드마다 표시



<br />

6. 시각화 (VisualizationPage) - 관리자 전용
6.1 초기 로드

관리자만 접근 가능
페이지 진입 시 "기본 기간"(예: 오늘 혹은 최근 일주일 등)으로 서버에서 데이터 로드
기본 그래프(시간대별 접수량 등) 자동 표시

6.2 시각화 종류

시간대별 접수량

create_time 기준으로 09 ~ 18시(1시간 단위), 18 ~ 20, 20 ~ 00, 00 ~ 09 구간별 주문 건수
CS/HES/LENOVO 3개 부서 각각의 건수를 막대그래프로 표시
막대 위에 실제 건수(라벨) 표시


부서별 상태 현황

ETA 기준으로 기간 내 데이터에서 부서별 5가지 상태(대기, 진행, 완료, 이슈, 취소) 비율
부서당 파이 차트 1개씩 표시, 파이 조각에 건수 혹은 비율 라벨 표시



6.3 기간·그래프 유형 변경

기간 선택 드롭다운 → 해당 기간 데이터를 로드해 재그래프
그래프 유형(예: 막대, 파이) 전환 가능

<br />

7. 사용자 관리 (UserManagePage) - 관리자 전용
7.1 초기 로드

관리자만 접근 가능
모든 사용자 목록을 로드해 테이블 표시 (권한, ID, 이름 등)

7.2 사용자 관리 기능

사용자 추가: ID, PW, department, 권한 지정
사용자 삭제: 관리자만 가능

<br />

8. 우편번호 처리

독립된 우편번호 API/로직은 모두 삭제됨
주문 생성·수정 시 postal_code(5자리)만 입력
4자리 입력 시 앞에 '0'을 자동으로 보완(프론트·백 동일)

<br />

9. UI/UX 특성 및 디자인 원칙
9.1 테이블 디자인

행 색상: 주문 상태에 따라 행 전체 배경색 다르게 표시
컬럼 커스터마이징: 사용자가 원하는 컬럼만 선택적 표시 가능
행 클릭: 행 클릭 시 상세 정보 모달 표시 (체크박스 영역 제외)
체크박스 선택: 선택 시 테이블 상단에 액션 패널 표시

9.2 액션 및 상호작용

상단 액션 버튼: 새로고침, 신규 등록 등 항상 사용 가능한 기능
선택 액션 버튼: 선택된 행이 있을 때만 상단에 나타나는 상태 변경, 배차, 삭제 버튼
행 단위 락 알림: 팝업으로 락 상태 및 소유자 정보 표시

9.3 반응형 디자인

화면 크기에 따라 레이아웃 자동 조정
작은 화면에서는 컬럼 축소 및 UI 요소 재배치

<br />

10. 공통 처리 사항
10.1 마지막 수정자/수정 시간

생성, 수정, 삭제, 상태 변경 등 모든 변경 작업마다

마지막 수정자, 최종 수정 시간 필드에 기록


이력 테이블 없이 현재 정보만 계속 갱신(덮어쓰기)

10.2 로그 / 알림

상태 롤백 시 알림 필수 (관리자 권한)
행 단위 락 거부 시 어느 유저가 사용 중인지 표시
일괄 처리 결과 성공/실패/락 상태 건수 요약 알림