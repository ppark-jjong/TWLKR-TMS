# 프로젝트 상세 기능 동작서 (최신 수정본)

## 1. 권한 시스템

### 관리자 권한 (ADMIN)
- **접근 가능 페이지**: 대시보드, 인수인계, 시각화, 사용자 관리 등 모든 페이지
- **데이터 권한**: 모든 데이터 조회/생성/수정/삭제 가능
- **주문 상태 제어**: 모든 상태 간 변경 가능 (역행 포함)
- **사용자 관리**: 사용자 생성, 조회, 삭제, 권한 변경 가능

### 일반 사용자 권한 (USER)
- **접근 가능 페이지**: 대시보드, 인수인계만 접근 가능
- **데이터 권한**:
  - 조회: 모든 데이터 조회 가능
  - 생성: 새 항목 생성 가능
  - 삭제: 본인이 생성한 항목만 삭제 가능
  - 수정: 수정 불가능
- **주문 상태 제어**: 제한적 상태 변경만 가능
  - 대기 → 진행 (가능)
  - 진행 → 완료/이슈/취소 (가능)
  - 역행 불가 (예: 완료 → 진행 불가)

---

## 2. 인증 및 세션 관리

### 로그인 프로세스
- **초기 접근**: 인증되지 않은 상태로 어떤 페이지 접근 시 로그인 페이지로 자동 리다이렉션
- **로그인 수행**: 사용자가 ID/PW 입력 후 로그인 시, 서버에 인증 요청
- **세션 설정**: 서버에서 인증 성공 시 세션 쿠키 설정
- **자동 리다이렉션**: 로그인 성공 시 대시보드 페이지(`/dashboard`)로 자동 이동

### 세션 관리
- **세션 확인**: 모든 페이지 로드 시 세션 유효성 자동 확인
- **세션 만료**: 세션 만료 시 자동으로 로그인 페이지로 리다이렉션
- **로그아웃**: 로그아웃 시 세션 삭제 및 로그인 페이지로 리다이렉션

---

## 3. 대시보드 페이지 (DashboardPage)

### 초기 로드 동작
- **자동 데이터 조회**: 페이지 마운트 시 자동으로 오늘 날짜 기준 데이터 조회
- **기본 필터 설정**: ETA 날짜 필터가 오늘 날짜로 자동 설정
- **상태별 요약**: 대기/진행/완료/이슈/취소 상태별 주문 건수 계산 및 표시

### 필터링 및 검색
- **ETA 날짜 필터**: 날짜 범위 변경 시 서버에 해당 기간 데이터 요청 (SSR)
- **클라이언트 필터링**: 상태, 부서, 창고는 이미 로드된 데이터를 클라이언트에서 필터링 (CSR)
- **검색 기능**: order_no만으로 검색 가능, DB에 직접 검색 요청

### 테이블 기능
- **컬럼 커스터마이징**: 표시할 컬럼 선택 및 순서 변경 가능
- **페이지네이션**: 페이지 단위로 데이터 로드
- **행 선택**: 체크박스로 다중 행 선택 기능
- **행 클릭**: 행 클릭 시 상세 정보 모달 표시
- **데이터 다운로드**: 현재 선택된 날짜 기간 데이터를 xlsx 형식으로 다운로드

### 주문 관리
- **주문 조회**: 목록에서 주문 클릭 시 상세 정보 모달 표시
- **주문 추가**: 새 주문 버튼 클릭 시 모달에서 정보 입력 후 생성
- **주문 삭제**: USER는 본인 생성 항목만, ADMIN은 모든 항목 삭제 가능
- **상태 변경**:
  - 단일/다중 행 선택 후 상태 변경 가능
  - 상태 변경 시 자동 시간 기록:
    - 대기 → 진행 시 depart_time 자동 기록
    - 진행 → 완료/이슈/취소 시 complete_time 자동 기록
  - USER는 정해진 규칙대로만 변경 가능, ADMIN은 모든 상태 변경 가능
- **기사 배정**: 단일/다중 선택 주문 기사 일괄 배정 기능
- **수정 이력**: 모든 변경 시 마지막 수정자 및 수정 시간만 기록 (덧씌우기)

---

## 4. 인수인계 페이지 (HandoverPage)

### 초기 로드 동작
- **자동 데이터 조회**: 페이지 마운트 시 모든 인수인계 데이터 자동 로드
- **목록 표시**: 인수인계 목록을 테이블 형태로 표시
- **로딩 상태**: 데이터 로드 중 로딩 스피너 표시

### 인수인계 관리
- **인수인계 조회**: 모든 인수인계 내역 조회 가능
- **인수인계 생성**:
  - 새 인수인계 정보 입력 및 저장
  - "공지사항 등록" 체크박스 제공
  - 체크 시 공지사항으로 등록되고, 미체크 시 일반 인수인계로 등록
- **인수인계 삭제**: USER는 본인 작성 항목만, ADMIN은 모든 항목 삭제 가능
- **인수인계 수정**: 수정 불가능 (삭제 후 재생성 필요)

### 테이블 기능
- **컬럼 커스터마이징**: 표시할 컬럼 선택 및 순서 변경 가능
- **페이지네이션**: 페이지 단위로 데이터 로드
- **행 클릭**: 행 클릭 시 상세 내용 모달 표시

---

## 5. 시각화 페이지 (VisualizationPage) - 관리자 전용

### 초기 로드 동작
- **접근 제한**: 관리자(ADMIN)만 접근 가능
- **자동 데이터 로드**: 페이지 마운트 시 기본적으로 저번 주(예시)의 데이터를 자동 조회
- **기본 그래프 표시**: 저번 주 데이터의 전처리 결과값을 그래프로 자동 표시

### 시각화 옵션
- **기간 선택**: 다른 기간을 선택하면 해당 기간의 데이터로 그래프를 업데이트
- **그래프 유형 전환**: 다양한 유형의 그래프로 전환 가능 (막대, 원형, 선형 등)
- **데이터 필터링**: 특정 조건에 따라 데이터를 필터링하여 시각화 가능

### 세부 기능
- **드롭다운 선택**: 시각화할 대상 선택을 위한 드롭다운을 제공
  1. **시간대별 주문량**
     - 사용자가 지정한 기간 내 `create_time` 컬럼을 기준으로 주문 건수를 집계
     - 시간 구간은 아래와 같이 구분:
       - **09시 ~ 18시**: 1시간 단위
       - **18시 ~ 20시**, **20시 ~ 00시**, **00시 ~ 09시**: 각 구간별로 묶어서 집계
     - 3개 부서 각각 해당 시간대에 발생한 주문 건수 집계
     - **막대 그래프** 형태로 시각화
     - **그래프 데이터 라벨(값) 명시**: 모든 막대 위에 해당 부서 주문 건수를 표시
  2. **부서별 상태 현황**
     - 사용자가 지정한 기간 내 `ETA` 컬럼을 기준으로 3개 부서 각각 5가지 상태(대기, 진행, 완료, 이슈, 취소)의 건수 비율을 계산
     - 각 부서별로 **원형 그래프(파이 차트)**를 생성해 상태 비율 표시
     - **그래프 데이터 라벨(값) 명시**: 파이 차트 각 영역별 건수 또는 비율을 표시

---

## 6. 사용자 관리 페이지 (UserManagePage) - 관리자 전용

### 초기 로드 동작
- **접근 제한**: 관리자(ADMIN)만 접근 가능
- **사용자 목록 로드**: 페이지 마운트 시 모든 사용자 목록 자동 로드
- **테이블 표시**: 사용자 정보를 테이블 형태로 표시

### 사용자 관리 기능
- **사용자 추가**: 새 사용자 등록 (ID, 비밀번호, 이름, 권한 등)
- **사용자 조회**: 모든 사용자 정보 조회
- **사용자 삭제**: 사용자 계정 삭제

---

## 7. API 통신 구조

### 데이터 요청 흐름
- **컴포넌트 마운트**: 각 페이지 컴포넌트 마운트 시 자동으로 관련 API 호출
- **데이터 요청 중**: 로딩 스피너 표시
- **데이터 수신 후**: 응답 데이터를 상태에 저장 후 UI에 렌더링
- **오류 발생 시**: 적절한 오류 메시지 표시

---

## 8. 상태 관리 시스템

### 주문 상태 흐름
- **상태 종류**: 총 5가지 상태 (대기, 진행, 완료, 이슈, 취소)
- **상태 전이 규칙**:
  - ADMIN: 모든 상태 간 변경 가능
  - USER:
    - 대기 → 진행 (가능)
    - 진행 → 완료/이슈/취소 (가능)
    - 그 외 전이 불가능
- **시간 기록**:
  - 대기 → 진행 시 depart_time 자동 기록
  - 진행 → 완료/이슈/취소 시 complete_time 자동 기록

### 데이터 수정 이력
- **모든 변경 작업**: 마지막 수정자 ID 및 수정 시간 기록
- **이력 관리 방식**: 최신 정보로 덧씌우기(이전 이력은 별도 보관하지 않음)
