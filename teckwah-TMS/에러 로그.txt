# SQLAlchemy 테이블 중복 정의 오류 분석 및 해결 방안

## 오류 분석

발생한 오류는 SQLAlchemy가 테이블 정의 충돌을 발견했다는 메시지입니다:

```
sqlalchemy.exc.InvalidRequestError: Table 'handover' is already defined for this MetaData instance. Specify 'extend_existing=True' to redefine options and columns on an existing Table object.
```

### 상세 원인

1. **테이블 중복 정의**: 
   - 동일한 SQLAlchemy MetaData 인스턴스에 'handover' 테이블이 두 번 정의되었습니다.
   - 문제는 우리가 새로 만든 `handover.py` 파일과 기존에 존재하는 `handover_model.py` 파일이 모두 같은 테이블명을 정의하기 때문에 발생했습니다.

2. **임포트 경로 충돌**:
   - 오류 로그에서 볼 수 있듯이, 프로젝트가 실행될 때 두 파일을 모두 임포트하려고 시도합니다.
   - Python은 모듈을 한 번 임포트하면 메모리에 캐시하지만, 서로 다른 경로로 임포트하면 중복될 수 있습니다.

## 해결 방안

이 문제를 해결하기 위한 두 가지 접근법이 있습니다:

### 방법 1: 기존 모델 파일 수정 (권장)

1. 새로 만든 `handover.py` 및 `user.py` 파일을 삭제합니다.
2. 기존 모델 파일(`handover_model.py`, `user_model.py`)을 수정하여 필요한 필드와 구조를 반영합니다.
3. 서비스 파일의 임포트 경로를 기존 모델 파일을 가리키도록 원래대로 돌립니다.

### 방법 2: extend_existing=True 추가

새 모델 클래스 정의에 `__table_args__`를 추가하여 이미 존재하는 테이블을 확장하도록 설정합니다:

```python
class Handover(Base):
    __tablename__ = "handover"
    __table_args__ = {"extend_existing": True}
    
    # 모델 필드들...
```

하지만 이 방법은 두 개의 모델 정의 간에 불일치가 있을 경우 예측할 수 없는 동작을 유발할 수 있으므로 권장하지 않습니다.

## 구체적인 해결 단계

가장 깔끔한 해결 방법은 기존 모델 파일을 수정하는 것입니다:

1. 새로 만든 파일들 삭제:
   - `C:\MyMain\teckwah-dashboard\teckwah-TMS\main\models\handover.py`
   - `C:\MyMain\teckwah-dashboard\teckwah-TMS\main\models\user.py`

2. 기존 모델 파일 수정:
   - `handover_model.py`와 `user_model.py` 파일을 업데이트하여 필요한 필드 추가

3. 서비스 파일의 임포트 문 수정:
   - `handover_service.py`와 `user_service.py` 파일에서 올바른 모델 경로 지정

4. Docker 컨테이너 재시작:
   - 변경사항을 적용하려면 컨테이너를 다시 빌드하고 시작하세요

## 결론

이 오류는 동일한 테이블을 두 번 정의했기 때문에 발생했습니다. SQLAlchemy 모델 구조에서는 하나의 테이블에 대해 하나의 모델 클래스만 존재해야 합니다. 기존 모델 파일을 올바르게 수정하고 불필요한 중복 파일을 제거하면 이 문제를 해결할 수 있습니다.