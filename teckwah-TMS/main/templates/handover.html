{% extends "base.html" %}

{% block title %}인수인계 - Teckwah TMS{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/handover.css') }}">
{% endblock %}

{% block content %}
<div class="handover-page">
    <div class="main-card">
        <!-- 페이지 제목 -->
        <div class="page-header">
            <h2 class="page-title">인수인계 및 공지사항</h2>
        </div>
        
        <!-- 필터 헤더 영역 (간소화) -->
        <div class="filter-bar">
            <!-- 탭 영역 -->
            <div class="tabs">
                <button class="tab active" data-tab="all">
                    <i class="fa-solid fa-list"></i>
                    전체 <span class="badge">0</span>
                </button>
                <button class="tab" data-tab="notice">
                    <i class="fa-solid fa-bullhorn"></i>
                    공지사항 <span class="badge">0</span>
                </button>
                <button class="tab" data-tab="handover">
                    <i class="fa-solid fa-exchange"></i>
                    인수인계 <span class="badge">0</span>
                </button>
            </div>
            
            <!-- 액션 버튼 영역 -->
            <div class="actions-row">
                <div class="right-actions">
                    <button id="refreshBtn" class="btn secondary-btn">
                        <i class="fa-solid fa-arrows-rotate"></i> 새로고침
                    </button>
                    <button id="newHandoverBtn" class="btn primary-btn">
                        <i class="fa-solid fa-plus"></i> 신규 작성
                    </button>
                </div>
            </div>
        </div>

        <!-- 데이터 테이블 -->
        <div class="table-scroll-container">
            <div class="table-container">
                <table class="data-table" id="handoverTable">
                    <thead>
                        <tr>
                            <th>No.</th>
                            <th>제목</th>
                            <th>유형</th>
                            <th>우선순위</th>
                            <th>작성자</th>
                            <th>작성일시</th>
                        </tr>
                    </thead>
                    <tbody id="handoverTableBody">
                        {% for item in handovers %}
                        <tr class="handover-row {{ item.type|lower }}-row priority-{{ item.priority|lower }} clickable-row" data-href="/handover/{{ item.handover_id }}">
                            <td>{{ loop.index }}</td>
                            <td class="title-cell">{{ item.title }}</td>
                            <td>
                                <span class="tag {{ item.type|lower }}-tag">
                                    {% if item.type == 'NOTICE' %}공지{% else %}인수인계{% endif %}
                                </span>
                            </td>
                            <td>
                                <span class="priority-badge priority-{{ item.priority|lower }}">
                                    {% if item.priority == 'HIGH' %}높음{% elif item.priority == 'MEDIUM' %}중간{% else %}낮음{% endif %}
                                </span>
                            </td>
                            <td>{{ item.created_by }}</td>
                            <td>{{ item.created_at|datetime }}</td>
                        </tr>
                        {% else %}
                        <tr class="empty-data-row">
                            <td colspan="6" class="empty-table">
                                <div class="empty-placeholder">
                                    <i class="fa-solid fa-clipboard-list"></i>
                                    <p>인수인계 및 공지사항이 없습니다</p>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 페이지네이션 -->
        <div class="pagination-container">
            <div class="pagination" id="pagination">
                <button class="page-btn" data-page="prev" {% if current_page == 1 %}disabled{% endif %}>
                    <i class="fa-solid fa-chevron-left"></i>
                </button>
                <span class="page-info" id="pageInfo">{{ current_page }} / {{ total_pages }}</span>
                <button class="page-btn" data-page="next" {% if current_page == total_pages %}disabled{% endif %}>
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block page_js %}
<script>
    // 행 클릭 이벤트 처리
    document.addEventListener('DOMContentLoaded', function() {
        const rows = document.querySelectorAll('.clickable-row');
        rows.forEach(row => {
            row.addEventListener('click', function() {
                const href = this.getAttribute('data-href');
                if (href) {
                    window.location.href = href;
                }
            });
        });
        
        // 기존 스크립트 로드
        const script = document.createElement('script');
        script.src = "{{ url_for('static', path='js/handover.js') }}";
        document.body.appendChild(script);
    });
</script>
{% endblock %}