{% extends "layout.html" %}

{% block title %}인수인계 - TeckWahKRTMS{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/handover.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
{% endblock %}

{% block content %}
<div class="page-header">
  <h1 class="page-title">인수인계</h1>
  <div class="page-actions">
    <button class="create-button" id="createHandoverBtn">
      <i class="fas fa-plus"></i> 인수인계 작성
    </button>
  </div>
</div>

<div class="handover-container">
  <!-- 공지사항 섹션 -->
  <section class="notice-section panel">
    <div class="panel-header">
      <h2 class="panel-title"><i class="fas fa-bullhorn"></i> 공지사항</h2>
      <div class="panel-toggle" onclick="togglePanel(this, 'notice-content')">
        <i class="fas fa-chevron-up"></i>
      </div>
    </div>
    <div class="panel-content notice-content">
      <div class="table-responsive">
        <table class="handover-table">
          <thead>
            <tr>
              <th width="8%">번호</th>
              <th width="55%">제목</th>
              <th width="15%">작성자</th>
              <th width="15%">작성일시</th>
              <th width="7%">보기</th>
            </tr>
          </thead>
          <tbody>
            {% for item in notices %}
            <tr data-id="{{ item.id }}" class="handover-row notice-row">
              <td>{{ item.id }}</td>
              <td class="title-cell">{{ item.title }}</td>
              <td>{{ item.writer }}</td>
              <td>{{ item.update_at|datetime }}</td>
              <td>
                <button
                  class="action-btn view-btn"
                  data-id="{{ item.id }}"
                  title="상세 보기"
                >
                  <i class="fas fa-eye"></i>
                </button>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="5" class="no-results">
                <div class="empty-state">
                  <i class="fas fa-info-circle"></i>
                  <span>등록된 공지사항이 없습니다.</span>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- 인수인계 섹션 -->
  <section class="handover-section panel">
    <div class="panel-header">
      <h2 class="panel-title"><i class="fas fa-exchange-alt"></i> 인수인계 목록</h2>
    </div>
    
    <div class="panel-content">
      <div class="table-responsive">
        <table class="handover-table">
          <thead>
            <tr>
              <th width="8%">번호</th>
              <th width="50%">제목</th>
              <th width="15%">작성자</th>
              <th width="15%">작성일시</th>
              <th width="12%">액션</th>
            </tr>
          </thead>
          <tbody>
            {% for item in handovers %}
            <tr data-id="{{ item.id }}" class="handover-row">
              <td>{{ item.id }}</td>
              <td class="title-cell">{{ item.title }}</td>
              <td>{{ item.writer }}</td>
              <td>{{ item.update_at|datetime }}</td>
              <td class="action-cell">
                <button
                  class="action-btn view-btn"
                  data-id="{{ item.id }}"
                  title="상세 보기"
                >
                  <i class="fas fa-eye"></i>
                </button>
                {% if user.user_id == item.writer_id or user.user_role == 'ADMIN' %}
                <button
                  class="action-btn edit-btn"
                  data-id="{{ item.id }}"
                  title="수정하기"
                >
                  <i class="fas fa-edit"></i>
                </button>
                <button
                  class="action-btn delete-btn"
                  data-id="{{ item.id }}"
                  title="삭제하기"
                >
                  <i class="fas fa-trash-alt"></i>
                </button>
                {% endif %}
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="5" class="no-results">
                <div class="empty-state">
                  <i class="fas fa-clipboard-list"></i>
                  <span>등록된 인수인계 내역이 없습니다.</span>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- 페이지네이션 -->
      <div id="handover-pagination" class="pagination-container">
        <!-- 여기에 페이지네이션이 동적으로 생성됩니다 -->
      </div>
    </div>
  </section>
</div>

<!-- 모달은 JavaScript에서 동적으로 생성 -->
{% endblock %}

{% block extra_js %}
<!-- 인수인계 스크립트 -->
<script src="/static/js/handover.js"></script>

<!-- 패널 토글 함수 -->
<script>
  window.togglePanel = function(toggleElement, contentClass) {
    const panel = toggleElement.closest('.panel');
    const content = panel.querySelector('.' + contentClass);
    const icon = toggleElement.querySelector('i');
    
    if (content.style.display === 'none') {
      content.style.display = 'block';
      icon.className = 'fas fa-chevron-up';
    } else {
      content.style.display = 'none';
      icon.className = 'fas fa-chevron-down';
    }
  };
</script>
{% endblock %}
