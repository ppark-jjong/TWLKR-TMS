{% extends "base.html" %}

{% block title %}인수인계 - Teckwah TMS{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/handover.css') }}">
{% endblock %}

{% block content %}
<div class="handover-page">
    <div class="page-header">
        <h1 class="page-title">
            <i class="fa-solid fa-right-left"></i>
            인수인계 및 공지사항
        </h1>
        <div class="header-actions">
            <button id="refreshBtn" class="btn secondary-btn">
                <i class="fa-solid fa-arrows-rotate"></i>
                새로고침
            </button>
            <button id="newHandoverBtn" class="btn primary-btn">
                <i class="fa-solid fa-plus"></i>
                신규 작성
            </button>
        </div>
    </div>
    
    <div class="main-card">
        <!-- 필터 영역 -->
        <div class="filter-box">
            <div class="filter-controls">
                <div class="filter-item">
                    <label for="priorityFilter">우선순위</label>
                    <select id="priorityFilter" class="filter-select">
                        <option value="">전체</option>
                        <option value="HIGH">높음</option>
                        <option value="MEDIUM">중간</option>
                        <option value="LOW">낮음</option>
                    </select>
                </div>

                <div class="filter-item">
                    <label for="typeFilter">유형</label>
                    <select id="typeFilter" class="filter-select">
                        <option value="">전체</option>
                        <option value="NOTICE">공지</option>
                        <option value="HANDOVER">인수인계</option>
                    </select>
                </div>
            </div>

            <div class="search-container">
                <input type="text" id="searchKeyword" class="search-input" placeholder="검색어를 입력하세요">
                <button class="btn search-button" id="searchBtn">
                    <i class="fa-solid fa-search"></i>
                </button>
            </div>
        </div>

        <!-- 탭 영역 -->
        <div class="tabs">
            <button class="tab active" data-tab="all">
                <i class="fa-solid fa-list"></i>
                전체 <span class="badge">0</span>
            </button>
            <button class="tab" data-tab="notice">
                <i class="fa-solid fa-bullhorn"></i>
                공지사항 <span class="badge">0</span>
            </button>
            <button class="tab" data-tab="handover">
                <i class="fa-solid fa-exchange"></i>
                인수인계 <span class="badge">0</span>
            </button>
        </div>

        <!-- 데이터 테이블 -->
        <div class="table-container">
            <table class="data-table" id="handoverTable">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>제목</th>
                        <th>유형</th>
                        <th>우선순위</th>
                        <th>작성자</th>
                        <th>작성일시</th>
                        <th>액션</th>
                    </tr>
                </thead>
                <tbody id="handoverTableBody">
                    {% for item in handovers %}
                    <tr class="handover-row {{ item.type|lower }}-row priority-{{ item.priority|lower }}">
                        <td>{{ loop.index }}</td>
                        <td class="title-cell">
                            <a href="/handover/{{ item.handover_id }}">{{ item.title }}</a>
                        </td>
                        <td>
                            <span class="tag {{ item.type|lower }}-tag">
                                {% if item.type == 'NOTICE' %}공지{% else %}인수인계{% endif %}
                            </span>
                        </td>
                        <td>
                            <span class="priority-badge priority-{{ item.priority|lower }}">
                                {% if item.priority == 'HIGH' %}높음{% elif item.priority == 'MEDIUM' %}중간{% else %}낮음{% endif %}
                            </span>
                        </td>
                        <td>{{ item.created_by }}</td>
                        <td>{{ item.created_at|datetime }}</td>
                        <td class="action-cell">
                            <a href="/handover/{{ item.handover_id }}" class="btn-action">
                                <i class="fa-solid fa-eye"></i>
                            </a>
                            {% if user.user_id == item.created_by or user.user_role == 'ADMIN' %}
                            <a href="/handover/{{ item.handover_id }}/edit" class="btn-action">
                                <i class="fa-solid fa-edit"></i>
                            </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr class="empty-data-row">
                        <td colspan="7" class="empty-table">
                            <div class="empty-placeholder">
                                <i class="fa-solid fa-clipboard-list"></i>
                                <p>인수인계 및 공지사항이 없습니다</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- 페이지네이션 -->
        <div class="pagination" id="pagination">
            <button class="page-btn" data-page="prev" {% if current_page == 1 %}disabled{% endif %}>
                <i class="fa-solid fa-chevron-left"></i>
            </button>
            <span class="page-info" id="pageInfo">{{ current_page }} / {{ total_pages }}</span>
            <button class="page-btn" data-page="next" {% if current_page == total_pages %}disabled{% endif %}>
                <i class="fa-solid fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block page_js %}
<script src="{{ url_for('static', path='js/handover.js') }}"></script>
{% endblock %}
