{% extends "base.html" %}

{% block title %}주문 상세 - Teckwah TMS{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/orders.css') }}">
{% endblock %}

{% block content %}
<div class="order-detail-page">
    <!-- 헤더 부분 -->
    <div class="page-header">
        <h1 class="page-title">
            <i class="fa-solid fa-truck-fast"></i>
            주문 상세 정보
        </h1>
        <div class="header-actions">
            <a href="/dashboard" class="btn secondary-btn">
                <i class="fa-solid fa-arrow-left"></i>
                목록으로
            </a>
            <a href="/orders/{{ order.dashboard_id }}/edit" class="btn primary-btn">
                <i class="fa-solid fa-edit"></i>
                수정
            </a>
            {% if user and user.user_role == 'ADMIN' %}
            <button id="deleteOrderBtn" class="btn danger-btn">
                <i class="fa-solid fa-trash"></i>
                삭제
            </button>
            {% endif %}
        </div>
    </div>
    
    <div class="main-card">
        <div class="order-detail-content">
            <div class="order-detail-columns">
                <!-- 왼쪽 컬럼 -->
                <div class="detail-column">
                    <!-- 기본 정보 섹션 -->
                    <div class="order-detail-section">
                        <div class="section-title">
                            <i class="fa-solid fa-info-circle"></i>
                            기본 정보
                        </div>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">주문번호</span>
                                <div class="copyable-value">
                                    <span class="detail-value" id="detailOrderNo">{{ order.order_no }}</span>
                                    <button id="copyOrderNo" class="copy-btn">
                                        <i class="fa-regular fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">상태</span>
                                <span class="detail-value status-badge status-{{ order.status|lower }}">{{ order.status_label }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">고객</span>
                                <span class="detail-value">{{ order.customer }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">유형</span>
                                <span class="detail-value">{{ order.type_label }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">부서</span>
                                <span class="detail-value">{{ order.department }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">창고</span>
                                <span class="detail-value">{{ order.warehouse }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">SLA</span>
                                <span class="detail-value">{{ order.sla }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">우편번호</span>
                                <span class="detail-value">{{ order.postal_code }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- 배송 정보 섹션 (첫 부분) -->
                    <div class="order-detail-section">
                        <div class="section-title">
                            <i class="fa-solid fa-truck"></i>
                            배송 정보
                        </div>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">ETA</span>
                                <span class="detail-value">{{ order.eta|datetime }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">생성 시간</span>
                                <span class="detail-value">{{ order.create_time|datetime }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">출발 시간</span>
                                <span class="detail-value">{% if order.depart_time %}{{ order.depart_time|datetime }}{% else %}-{% endif %}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">완료 시간</span>
                                <span class="detail-value">{% if order.complete_time %}{{ order.complete_time|datetime }}{% else %}-{% endif %}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 오른쪽 컬럼 -->
                <div class="detail-column">
                    <!-- 배송 및 연락처 정보 섹션 -->
                    <div class="order-detail-section">
                        <div class="section-title">
                            <i class="fa-solid fa-map-location-dot"></i>
                            배송 및 연락처 정보
                        </div>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">배송기사</span>
                                <span class="detail-value">{% if order.driver_name %}{{ order.driver_name }}{% else %}-{% endif %}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">배송기사 연락처</span>
                                <span class="detail-value">{% if order.driver_contact %}{{ order.driver_contact }}{% else %}-{% endif %}</span>
                            </div>
                            <div class="detail-item full-width">
                                <span class="detail-label">배송주소</span>
                                <span class="detail-value">{{ order.address }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">연락처</span>
                                <span class="detail-value">{% if order.contact %}{{ order.contact }}{% else %}-{% endif %}</span>
                            </div>
                        </div>
                    </div>

                    <!-- 메모 섹션 -->
                    <div class="order-detail-section">
                        <div class="section-title">
                            <i class="fa-solid fa-note-sticky"></i>
                            메모
                        </div>
                        <div class="remark-container">
                            <span class="detail-value">{% if order.remark %}{{ order.remark }}{% else %}-{% endif %}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 업데이트 정보 푸터 -->
            <div class="order-footer">
                <div class="update-info">
                    <div class="update-item">
                        <i class="fa-solid fa-clock-rotate-left"></i>
                        <span class="update-label">업데이트:</span>
                        <span class="update-value">{{ order.update_at|datetime }}</span>
                    </div>
                    <div class="update-item">
                        <i class="fa-solid fa-user-edit"></i>
                        <span class="update-label">수정자:</span>
                        <span class="update-value">{{ order.update_by }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 삭제 확인 다이얼로그는 페이지 전환 방식으로 변경될 경우 필요 없을 수 있습니다 -->
<div id="deleteConfirmDialog" class="dialog">
    <div class="dialog-content">
        <h3>주문 삭제 확인</h3>
        <p>정말로 이 주문을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.</p>
        <div class="dialog-actions">
            <button class="btn secondary-btn" id="cancelDeleteBtn">취소</button>
            <form action="/orders/{{ order.dashboard_id }}/delete" method="POST">
                <button type="submit" class="btn danger-btn">삭제</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block page_js %}
<script src="{{ url_for('static', path='js/order_detail.js') }}"></script>
{% endblock %}
